---
import Base from "@/layouts/Base.astro";
import ImageMod from "@/components/ImageMod.astro";
import Share from "@/components/Share.astro";
import { getArticles, getAssetURL } from "@/lib/directus";
import { markdownify, humanize, slugify } from "@/lib/utils/textConverter";
import dateFormat from "@/lib/utils/dateFormat";
import { FaRegClock, FaRegFolder, FaRegUserCircle } from "react-icons/fa";

export async function getStaticPaths() {
  const articles = await getArticles();
  return articles.map((article) => ({
    params: { single: article.slug },
    props: { article },
  }));
}

const { article } = Astro.props;
const {
  title,
  content,
  author,
  publish_date,
  featured_image,
  categories,
  tags,
  meta_title,
  meta_description,
} = article;

const authorName = typeof author === "object" ? author?.name : "Admin";
const authorSlug = typeof author === "object" ? author?.slug : "#";
const categoryList = categories?.map((c: any) => c.categories_id?.name) || [];
const tagList = tags?.map((t: any) => t.tags_id?.name) || [];
const imageUrl = getAssetURL(featured_image);
---

<Base
  title={title}
  meta_title={meta_title || title}
  description={meta_description || content.slice(0, 150)}
  image={imageUrl}
>
  <section class="section pt-7">
    <div class="container">
      <div class="row justify-center">
        <article class="lg:col-10">
          {
            imageUrl && (
              <div class="mb-10 gsap-fade-up">
                <ImageMod
                  src={imageUrl}
                  height={500}
                  width={1200}
                  alt={title}
                  class="w-full rounded-xl shadow-md"
                  format="webp"
                />
              </div>
            )
          }

          <div class="gsap-fade-up">
            <h1 set:html={markdownify(title)} class="h2 mb-4" />
            <ul
              class="mb-4 text-text-light dark:text-darkmode-text-light flex flex-wrap gap-4"
            >
              <li class="inline-flex items-center">
                <FaRegUserCircle className="mr-2" />
                <a
                  href={`/authors/${authorSlug}`}
                  class="hover:text-primary transition-colors"
                  >{humanize(authorName)}</a
                >
              </li>
              <li class="inline-flex items-center">
                <FaRegFolder className="mr-2" />
                {
                  categoryList.map((category: string, index: number) => (
                    <a
                      href={`/categories/${slugify(category)}`}
                      class="hover:text-primary transition-colors"
                    >
                      {humanize(category)}
                      {index !== categoryList.length - 1 && ", "}
                    </a>
                  ))
                }
              </li>
              <li class="inline-flex items-center">
                <FaRegClock className="mr-2" />
                {dateFormat(publish_date || new Date())}
              </li>
            </ul>
          </div>

          <div class="content mb-10 gsap-fade-up">
            <div set:html={markdownify(content, true)} />
          </div>

          <div
            class="row items-start justify-between border-t border-border pt-10 dark:border-darkmode-border gsap-fade-up"
          >
            <div class="mb-10 flex items-center lg:col-5 lg:mb-0">
              <h5 class="mr-3">Tags :</h5>
              <ul>
                {
                  tagList.map((tag: string) => (
                    <li class="inline-block">
                      <a
                        class="m-1 block rounded bg-light px-3 py-1 hover:bg-primary hover:text-white dark:bg-darkmode-light dark:hover:bg-darkmode-primary dark:hover:text-text-dark transition-colors"
                        href={`/tags/${slugify(tag)}`}
                      >
                        {humanize(tag)}
                      </a>
                    </li>
                  ))
                }
              </ul>
            </div>
            <div class="flex items-center lg:col-4">
              <h5 class="mr-3">Share :</h5>
              <Share
                className="social-icons"
                title={title}
                description={meta_description}
                slug={`blog/${article.slug}`}
              />
            </div>
          </div>
        </article>
      </div>
    </div>
  </section>
</Base>
